package in.co.sunrays.model;

import java.sql.PreparedStatement;
import java.sql.ResultSet;

import com.mysql.jdbc.Connection;

import in.co.sunrays.bean.CourseBean1;
import in.co.sunrays.bean.SubjectBean1;
import in.co.sunrays.exception.ApplicationException;
import in.co.sunrays.exception.DatabaseException;
import in.co.sunrays.exception.DuplicateRecordException;
import in.co.sunrays.proj4.util.JDBCDataSource;

public class SubjectModel1 {

public Integer nextPK() throws DatabaseException { 	
	
	Connection conn = null;
	int pk = 0;
	try {
		conn = JDBCDataSource.getconnection();
	    PreparedStatement pstmt = conn.prepareStatement("select MAX(ID) FROM ST_SUBJECT"); 
		ResultSet rs = pstmt.executeQuery();
		while(rs.next()) {
		 pk = rs.getInt(1);
		}
		rs.close();
			} catch (Exception e) {
		throw new DatabaseException("Exception : Exception in getting PK");
	} finally {
		JDBCDataSource.closeConnection(conn);
	}
	return pk + 1;
}	



public long Add(SubjectBean1 bean) throws ApplicationException,DuplicateRecordException {

	Connection conn = null;
	
	CourseModel1 cmodel = new CourseModel1();
    CourseBean1 courseBean1 = cmodel.findByPK(bean.getCourseid());
	bean.setCourseName(courseBean1.getName());
	
	SubjectBean1 duplicateName = findbyName(bean.getName());

	int pk = 0 ;
	
	if (duplicateName != null){
		throw new DuplicateRecordException("Subject alredy exist");
	}
	
	try { 
		conn = JDBCDataSource.getconnection();
		pk = nextPK();
		conn.setAutoCommit(false);
		PreparedStatement pstmt = conn.prepareStatement("INSERT INTO ST_SUBJECT VALUES(?,?,?,?,?,?,?,?,?)");
		pstmt.setInt(pk, 0);
		
		
		
	}
	
	
}
}










